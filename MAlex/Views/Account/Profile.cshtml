@using MetroApp.Models
@model User
@{
    ViewData["Title"] = "Your Profile";
}
@section Styles {
    <link rel="stylesheet" href="~/css/profile.css" />
}

<section class="vh-150">
    <div class="container">
        <picture class="position-absolute top-0 start-0 ms-5">
            <img src="~/images/logo.jpg" class="rounded-circle" alt="" />
        </picture>
        <h1 class="text-center mb-3 pt-4 animate__animated animate__fadeInDown">Your Profile</h1>
        <div class="title">
            <p class="text-center mb-3 animate__animated animate__fadeInDown">
                Stay connected to every ride-your travel details, tickets, and updates in one place.
            </p>
        </div>

        <ul class="nav justify-content-center animate__animated animate__fadeIn">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#" onclick="displayProfile()">Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="displayTicket()">My Tickets</a>
            </li>
        </ul>

        <div class="row shadow p-3 mt-3 rounded main bg-white animate__animated animate__fadeIn">
            <div class="col-6">
                <div class="inner1 shadow rounded-4 p-3 d-flex justify-content-center align-items-center flex-column">
                    <img class="rounded-circle bg-white" src="~/images/testimonial-2.jpg" alt="User Photo" />
                    <div class="personal_info text-white text-center">
                        <p>@(Model.UserName ?? Model.Email)</p>
                        <span>@Model.Email</span>
                    </div>
                    <a asp-controller="Account" asp-action="UpdateProfile" class="text-bg-dark p-2">Edit Profile</a>
                    
                </div>
            </div>

            <div class="card1 col-4">
                <div class="welcome">
                    <p class="fs-3 fw-bold"><span>Welcome !</span> @(Model.UserName ?? Model.Email)</p>
                </div>

                <div class="inner shadow p-3 rounded-5" id="profileSection">
                    <h2 class="fs-10 ms-3">
                        <i class="fa-solid fa-note-sticky fs-5"></i> Personal Information.
                    </h2>
                    <div class="detailes row ms-10">
                        <div class="col-6">
                            <p class="fw-bold">Full Name: <span class="fw-light">@(Model.UserName ?? "N/A")</span></p>
                            <p class="fw-bold">
                                Role:
                                <span class="fw-light">
                                    @if (ViewBag.Roles != null && ((IList<string>)ViewBag.Roles).Count > 0)
                                    {
                                        <ul>
                                            @foreach (var role in (IList<string>)ViewBag.Roles)
                                            {
                                                <li>@role</li>
                                            }
                                        </ul>
                                    }
                                    else
                                    {
                                        <span>User</span>
                                    }
                                </span>
                            </p>


                           
                        </div>
                        <div class="col-3">
                            <p class="fw-bold">Phone: <span class="fw-light">@(Model.PhoneNumber ?? "N/A")</span></p>
                            <p class="fw-bold">Joined: <span class="fw-light">@Model.CreatedAt.ToString("MMMM yyyy")</span></p>
                        </div>
                    </div>
                </div>

                <div class="inner_ticket p-3 rounded-5 d-none" id="ticketSection">
                    <h2 class="fs-4 ms-3">
                        <i class="fa-solid fa-ticket"></i> My Tickets:
                    </h2>
                    <div class="row ms-3">
                        <div class="col-12 ticket">
                            @if (Model.UserTickets != null && Model.UserTickets.Any())
                            {
                                @foreach (var userTicket in Model.UserTickets.OrderByDescending(ut => ut.Ticket.PurchaseDate))
                                {
                                    var ticket = userTicket.Ticket;
                                    <div class="my_ticket shadow p-2 mt-4 rounded-3 position-relative">
                                        <div class="d-flex justify-content-start">
                                            <h3 class="fw-bold fs-5">Ticket #@ticket.TicketID</h3>
                                        </div>
                                        <div class="ms-4">
                                            <p class="fs-5 mb-0">Purchased Date: @ticket.PurchaseDate.ToString("MMM dd, yyyy")</p>
                                            @if (ticket.Trip != null)
                                            {
                                                <span class="text-muted fs-6">@ticket.Trip.StartStation?.StationName → @ticket.Trip.EndStation?.StationName</span>
                                                <br />
                                                <span class="text-muted fs-6">Price: @ticket.Trip.TotalPrice EGP</span>
                                            }
                                        </div>
                                        <form asp-controller="Ticket" asp-action="DeleteTicket" method="post" class="position-absolute bottom-0 end-0 p-2 bg-white rounded-circle m-3">
                                            <input type="hidden" name="id" value="@ticket.TicketID" />
                                            <button type="submit" class="border-0 bg-transparent">
                                                <i class="fa-solid fa-trash-can" style="color: #fa0000"></i>
                                            </button>
                                        </form>
                                    </div>
                                }
                            }
                            else
                            {
                                <p>No tickets found.</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/Profile.js"></script>
}

